plugins {
  id 'com.android.library'
  id 'org.jetbrains.kotlin.android'
  id 'org.jetbrains.kotlin.plugin.compose' version '2.1.20'
}

group = 'com.clerk.expo'
version = '1.0.0'

// Dependency versions - centralized for easier updates
// See: https://docs.gradle.org/current/userguide/version_catalogs.html for app-level version catalogs
ext {
  credentialsVersion = "1.3.0"
  googleIdVersion = "1.1.1"
  kotlinxCoroutinesVersion = "1.7.3"
  clerkAndroidVersion = "0.1.3"
  composeVersion = "1.7.0"
  activityComposeVersion = "1.9.0"
  lifecycleVersion = "2.8.0"
}

def safeExtGet(prop, fallback) {
  rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback
}

android {
  namespace "expo.modules.clerk"

  compileSdk safeExtGet("compileSdkVersion", 36)

  defaultConfig {
    minSdk safeExtGet("minSdkVersion", 24)
    targetSdk safeExtGet("targetSdkVersion", 36)
    versionCode 1
    versionName "1.0.0"
  }

  buildTypes {
    release {
      minifyEnabled false
    }
  }

  compileOptions {
    sourceCompatibility JavaVersion.VERSION_17
    targetCompatibility JavaVersion.VERSION_17
  }

  kotlinOptions {
    jvmTarget = "17"
  }

  buildFeatures {
    compose = true
  }

  sourceSets {
    main {
      java.srcDirs = ['src/main/java']
    }
  }
}

configurations.all {
  resolutionStrategy {
    // Force kotlin-stdlib to match Expo's Kotlin version
    force "org.jetbrains.kotlin:kotlin-stdlib:2.1.20"
    force "org.jetbrains.kotlin:kotlin-stdlib-jdk7:2.1.20"
    force "org.jetbrains.kotlin:kotlin-stdlib-jdk8:2.1.20"
  }
}

dependencies {
  // Expo modules core
  implementation project(':expo-modules-core')

  // Credential Manager for Google Sign-In with nonce support
  implementation "androidx.credentials:credentials:$credentialsVersion"
  implementation "androidx.credentials:credentials-play-services-auth:$credentialsVersion"
  implementation "com.google.android.libraries.identity.googleid:googleid:$googleIdVersion"

  // Coroutines for async operations
  implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:$kotlinxCoroutinesVersion"

  // Clerk Android SDK with prebuilt UI
  implementation "com.clerk:clerk-android-ui:$clerkAndroidVersion"

  // Jetpack Compose for wrapping Clerk views
  implementation "androidx.compose.ui:ui:$composeVersion"
  implementation "androidx.compose.material3:material3:1.3.0"
  implementation "androidx.activity:activity-compose:$activityComposeVersion"
  implementation "androidx.lifecycle:lifecycle-runtime-compose:$lifecycleVersion"
}
